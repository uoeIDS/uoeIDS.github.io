---
title: "Lab 03 â€“ Critical Use of GenAI for Data Science"
author: "KEY"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(nycflights13)
library(tidyverse)
library(ggplot2)
library(infer)
```

_Note, if nycflights13 in not installed in your system, RStudio might prompt you to install it, or simply run `install.packages("nycflights13")` in the console._

# 1. Data Structure Summary & Initial Exploration

## 1.1 Subset the Data

**Write code to create the subset `jan_feb_flights` below:**

```{r subset-data}
jan_feb_flights <- flights %>%
  filter(month %in% c(1, 2))
```

## 1.2 Column Overview

Explore the columns in `jan_feb_flights`.
Which are numeric, which are categorical/text/factor?  
Are there missing values?

```{r}
# explore the types of the columns in jan_feb_flights
jan_feb_flights %>%
  summarise_all(typeof) %>%
  pivot_longer(everything(), names_to = "column", values_to = "type")
```

```{r}
# which columns are integer
jan_feb_flights %>% 
  summarise_all(typeof) %>% 
  pivot_longer(everything(), names_to = "column", values_to = "type") %>%
  filter(type == "integer")

# which columns are double
jan_feb_flights %>% 
  summarise_all(typeof) %>% 
  pivot_longer(everything(), names_to = "column", values_to = "type") %>%
  filter(type == "double")

# which columns are character
jan_feb_flights %>% 
  summarise_all(typeof) %>% 
  pivot_longer(everything(), names_to = "column", values_to = "type") %>%
  filter(type == "character")
```

```{r}
# which columns contain NA's
jan_feb_flights %>%
  summarise(across(everything(), ~sum(is.na(.))))
```

**Summary:**  

_Use this space to summarize what you attempted, either from your own exploration or an AI explanation._

## 1.3 Reflection

Did the GenAI explanation (if used) help you? What was clear or unclear? Did it make any errors or skip anything important? Did you fact-check? Did you need to provide follow-up prompts or clarifications, or was the first response sufficient?

_Your answer here_

---

# 2. Delays & Weather

**Goal:** Analyze relationship between average departure delay and wind gust speed.

```{r}
# join the datasets
jan_feb_flights <- jan_feb_flights %>%
  left_join(weather, by = c("origin","year","month","day","hour")) 
```

```{r}
# is there a difference in wind speed when wind_gust is missing vs not missing?
jan_feb_flights %>% 
  filter(is.na(wind_gust)) %>%
  summarise(avg_wind_speed = mean(wind_speed, na.rm = TRUE),
            sd_wind_speed = sd(wind_speed, na.rm = TRUE),
            n())

jan_feb_flights %>% 
  filter(!is.na(wind_gust)) %>%
  summarise(avg_wind_speed = mean(wind_speed, na.rm = TRUE),
            sd_wind_speed = sd(wind_speed, na.rm = TRUE),
            n())
```

Describe the difference in wind speed when wind_gust is missing vs not missing:

_Your answer here_
When wind_gust is missing, the average wind speed is much lower (9.1 mph) compared to when wind_gust is present (average is 19.1 mph). The standard deviations in the two groups are comparable, and the number of points to calculate this are also in the same scale.
This indicates that the presence of recorded wind gusts is associated with higher wind speeds.

```{r}
# create a new variable, gust_present
jan_feb_flights <- jan_feb_flights %>%
  mutate(gust_present = ifelse(!is.na(wind_gust), TRUE, FALSE))
```


```{r}
# is there a relationship between gust_present and dep_delay?
jan_feb_flights %>%
  group_by(gust_present) %>%
  summarise(avg_dep_delay = mean(dep_delay, na.rm = TRUE),
            sd_dep_delay = sd(dep_delay, na.rm = TRUE))
```

Describe the relationship between gust_present and dep_delay you see (if any).

_Your answer here_
There is no clear difference in the average departure delay when wind gust are recorded or not.
While the average delay is somewhat higher when gusts are present, the standard deviations in the two groups are so large that this difference is not meaningful.

## 2.1 Reflection

Was GenAI helpful as a navigator? Did it ask you questions to guide your thinking? Is there anything you could learn from this to be a better navigator, next time we will work in pairs?

_Your answer here_

---

# 3. Bootstrap confidence intervals

## 3.1 Bootstrap CI using `infer`

```{r}
# focus on flights departing from JFK with non-missing dep_delay
jfk_flights <- jan_feb_flights %>%
 filter(origin == "JFK", !is.na(dep_delay))

# Construct bootstrap distribution
set.seed(99)  # for reproducibility
boot_dist <- jfk_flights %>%
  specify(response = dep_delay) %>%        
  generate(reps = 1500, type = "bootstrap") %>%
  calculate(stat = "mean")                 

# Compute 95% confidence interval (percentile method)
boot_dist %>%
  summarise(
    lower_95 = quantile(stat, 0.025),
    upper_95 = quantile(stat, 0.975)
  )

# Also compute and print the sample mean
mean_dep_delay <- jfk_flights %>% summarise(mean_jfk = mean(dep_delay)) %>% pull(mean_jfk)
```

**Interpretation for the confidence interval**:

_Your answer here_
The 95% confidence interval for the mean departure delay at JFK, as calculated by bootstrapping, is [9.5, 10.6] minutes. This means we are 95% confident that the true average departure delay for January/February JFK flights lies within this range. If we repeated the data collection and bootstrapping procedure many times, approximately 95% of such constructed intervals would contain the true mean.

## 3.2 Using base R

The following code achieves the same using base R and a for loop. 
Ask GenAI to explain how it works and discuss it with the group. Then find a tutor, and try to explain them what you did or didn't understand.


```{r}
set.seed(99)
n <- nrow(jfk_flights)
B <- 1500       
boot_means2 <- numeric(B)

for (i in 1:B) {
  idx <- sample(n, replace = TRUE)
  boot_means2[i] <- mean(jfk_flights$dep_delay[idx])
}

ci2_lower <- quantile(boot_means2, 0.025)
ci2_upper <- quantile(boot_means2, 0.975)

mean_dep_delay; ci2_lower; ci2_upper
```

## 3.3 Reflection

What was good and what was bad of GenAI's explanation? Did you have to clarify or re-prompt? 
Did it match the information provided by the tutor?

_Your answer here_

---

# 4. Airline Delay Analysis

**Goal:** For each airline, what are the mean and median arrival delays in Jan/Feb? Which is the worst on average?

```{r}
# Join jan_feb_flights with airlines by carrier code
jan_feb_flights <- jan_feb_flights %>%
  left_join(airlines, by = "carrier")
```


```{r wrangling1}
# Group by airline, summarize n, mean and median arrival delay
# Arrange descending by mean delay

jan_feb_flights %>%
  group_by(name) %>%
  summarise(
    n = n(),
    mean_arr_delay = mean(arr_delay, na.rm = TRUE),
    median_arr_delay = median(arr_delay, na.rm = TRUE)
  ) %>%
  arrange(desc(mean_arr_delay)) 
```

**Which airline(s) had the highest mean? Is there anything notable about the worst airline?**

_Your answer here_
SkyWest Airlines had the highest mean arrival delay (107 minutes). However, only one observation was recorded for this airline, which may not provide a reliable estimate of its typical performance.

## 4.1 Reflection

What did GenAI help with? Was anything inaccurate, missing, or did you spot any typical "AI mistakes"? Or did you instead learn something new? Did you have to clarify or re-prompt?

_Your answer here_

---

# 5. GenAI Use Reflection

- Discuss with your teammates, what are the risks of using GenAI for coding? 
- More specifically, what are the risks of copying code verbatim?
- Discuss the differences for someone who is just learning to code (like you) versus someone who is already proficient.
- What are your thoughts on using GenAI as a *thinking partner* or *pair-programming navigator*, rather than a code-generator?
- What are your thoughts on attempting a task on your own first, and then asking GenAI for help or feedback?
- What is one insight or tip each of you learned today about using GenAI productively or spotting misleading AI-generated code?

_Your answer here_

---

# 6. GenAI Acknowledgment

_If you used AI for this lab, provide a statement like (make sure to specify which GenAI tool you used):_

> I used ELM/ChatGPT/Copilot to discuss wrangling and explain Base R code, and to clarify syntax. I did not copy any code directly, and verified any advice through my own R coding and interpretation.

---

# Wrapping Up

_Save, commit, and push your file. Remember to acknowledge any GenAI help above._

